* 美团如何用机器学习优化推荐系统算法
本文介绍了美团网推荐系统的构建和优化过程中的一些做法，包括数据层、触发
层、融合过滤层和排序层五个层次，采用了HBase、Hive、storm、Spark和机器
学习等技术。两个优化亮点是将候选集进行融合与引入重排序模型。

在用户意图明确时，我们通常用搜索引擎来解决互联网时代的信息过载问题，但
当用户的意图不明确或者很难用清晰的语义表达，搜索引擎就无能为力。此时，
借助推荐系统通过用户行为的分析理解其意图，为其推送个性化的结果，便成为
一种更好的选择。美团作为国内发展较快的O2O网站，有着大量的用户和丰富的
用户行为，这些为推荐系统的应用和优化提供了很好的条件。本文由美团技术团
队成员撰写，介绍其推荐系统的构建和优化过程中的一些做法。

** 框架
   [[file:..images/alg/kuangjia.jpg]]

从框架的角度看，推荐系统基本可以分为数据层、触发层、融合过滤层和排序层。
- 数据层：数据层包括数据生成和数据存储，主要是利用各种数据处理工具对原始日志进行
清洗，处理成格式化的数据，落地到不同类型的存储系统中，供下游的算法和模
型使用。
- 触发层：候选集触发层主要是从用户的历史行为、实时行为、地理位置等角度利
用各种触发策略产生推荐的候选集。候选集融合和过滤层有两个功能:
 -- 一是对出发层产生的不同候选集进行融合，提高推荐策略的覆盖度和精度；
 -- 另外还要承担一定的过滤职责，从产品、运营的角度确定一些人工规则，过滤
  掉不符合条件的item。
- 排序层：排序层主要是利用机器学习的模型对触发层筛选出来的候选集进行重排序。

同时，对与候选集触发和重排序两层而言，为了效果迭代是需要频繁修改的两层，
因此需要支持ABtest。为了支持高效率的迭代，我们对候选集触发和重排序两层
进行了解耦，这两层的结果是正交的，因此可以分别进行对比试验，不会相互影
响。同时在每一层的内部，我们会根据用户将流量划分为多份，支持多个策略同
时在线对比。

** 数据应用
数据乃算法、模型之本。美团作为一个交易平台，同时具有快速增长的用户量，
因此产生了海量丰富得用户行数据。当然，不同类型得数据的价值和反映的用户
意图的强弱也有所不同。

- 用户主动行为数据记录了用户在美团平台上不同得环节的各种行为，这些行为
  一方面用于候选集触发算法（在下一部分介绍）中的离线计算（主要是浏览、
  下单），另外一方面，这些行为代表的意图的强弱不同，因此在训练重排序模
  型时可以针对不同得行为设定不同得回归目标值，以更细地刻画用户的行为强
  弱程度。此外，用户对deal的这些行为还可以作为重排序模型的交叉验证，用
  于模型的离线训练和在线预测。
- 负反馈数据反映了当前的结果可能在某些方面不能满足用户的需求，因此在后
  续的候选集中需要考虑对特定得因素进行过滤或者降权，降低负面因素再次出
  现的几率，提高用户体验；同时在重排序的模型训练中，负反馈数据可以作为
  不可多得的负例参与模型训练，这些负例要比哪些展示后未电机、未下单的样
  本显著的多。

- 用户画像是刻画用户属性的基础数据，其中有些是直接获取的原始数据，有些
  是经过挖掘的二次加工数据，这些属性一方面可以用于候选集触发过程中对
  deal进行加权或降权，另外一方面可以作为重排序模型中的用户维度特征。

- 用过对UGC数据的挖掘可以提取一些关键词，然后使用这些关键词给deal打标
  签，用于deal的个性化展示。

** 策略触发
上文中我们提到了数据的重要性，但是数据的落脚点还是算法和模型。单纯的数
据只是一些字节的堆积，我们必须通过对数据清洗除去数据中的噪声，然后通过
算法和模型学习其中的规律，才能将数据的价值最大化。在本节中，将介绍推荐
候选集触发过程中用到的相关算法。

*** 协同过滤
提到推荐，就不得不说协同过滤，它几乎在每个推荐系统中都会用到。基本的算法
非常简单，但是要获得更好得效果，往往需要根据具体的业务做一些差异化的处理。

清楚作弊、刷单、代购等噪声数据。这些数据的存在会验证影响算法的效果，因此
要在第一步的数据清洗中就将这些数据剔除。

合理选取训练数据。选取的训练数据的时间窗口不宜过长，当然也不能过短。具体
的窗口期数据需要经过多次的实验来确定。同时可以考虑引入时间
