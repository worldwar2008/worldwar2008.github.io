---
layout: article
title:  "多进程"
categories: python
toc: true
ads: true
image:
    teaser: /teaser/python.jpg
---

# Table of Contents

1.  [写多进程的方法](#orge12f34a)
    1.  [进程池](#orgccec9ae)
    2.  [非进程池](#orgda2757b)


<a id="orge12f34a"></a>

# 写多进程的方法


<a id="orgccec9ae"></a>

## 进程池

如果要启动大量的子进程，可以用进程池的方式批量创建子进程：

    from multiprocessing import Pool
    import os, time, random
    
    def long_time_task(name):
        print('Run task %s (%s)...' % (name, os.getpid()))
        start = time.time()
        time.sleep(random.random() * 3)
        end = time.time()
        print('Task %s runs %0.2f seconds.' % (name, (end - start)))
    
    if __name__=='__main__':
        print('Parent process %s.' % os.getpid())
        p = Pool(4)
        for i in range(5):
            p.apply_async(long_time_task, args=(i,))
        print('Waiting for all subprocesses done...')
        p.close()
        p.join()
        print('All subprocesses done.')

对Pool对象调用join()方法会等待所有子进程执行完毕，调用join()之前必须先调用close()，调用close()之后就不能继续添加新的Process了。


<a id="orgda2757b"></a>

## 非进程池

    #!/bin/env python
    from multiprocessing import Process
    import os
    import time
    
    def run_proc(name):
        time.sleep(3)
        print 'Run child process %s (%s)...' % (name, os.getpid())
    
    if __name__=='__main__':
        print 'Parent process %s.' % os.getpid()
        processes = list()
        for i in range(5):
            p = Process(target=run_proc, args=('test',))
            print 'Process will start.'
            p.start()
            processes.append(p)
    
        for p in processes:
            p.join()
        print 'Process end.'

